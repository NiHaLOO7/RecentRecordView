<template>
    <div class={formElementClasses}>
        <label
            class="slds-form-element__label"
            for="combobox-id-2"
            id="combobox-label-id-130"
        >
            <abbr
                if:true={required}
                class="slds-required"
                title="required"
            >* </abbr>
            {label}
        </label>
        <div class="slds-form-element__control">
            <div class="slds-combobox_container">
                <div class={classes}>
                    <div
                        class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"
                        role="none"
                    >
                        <div class="slds-form-element">
                            <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right ">
                                <lightning-icon
                                    size="x-small"
                                    class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default"
                                    icon-name="utility:down"
                                ></lightning-icon>

                                <button class={comboboxClasses}
                                    disabled={disabled}
                                    aria-required={required}
                                    id="combobox-button" 
                                    onfocus={handleFocus}
                                    onblur={handleBlur}
                                    onclick={handleClick}
                                    aria-invalid={isInvalid}
                                    aria-describedby="form-error-01"
                                    type="button" 
                                    aria-expanded="false" 
                                    aria-haspopup="listbox"
                                    name="objectSelector" 
                                    role="combobox" 
                                    data-value="" 
                                    aria-disabled="false" 
                                    aria-label="Select an Object" 
                                    part="input-button" 
                                    data-function="combobox"
                                    aria-controls="dropdown-element">
                                 <span class="slds-truncate" part="input-button-value">{comboBoxLabel}</span>
                                </button>


                            </div>
                        </div>

                    </div>
                    <div
                        id="dropdown-element"
                        class="slds-dropdown slds-dropdown_fluid"
                        role="listbox"
                        onmousedown={handleDropdownMouseDown}
                        onmouseup={handleDropdownMouseUp}
                        onmouseleave={handleDropdownMouseLeave}
                    >

                    <!-- Search Box -->
                    <div class="slds-form-element slds-p-top-xx_small slds-m-bottom-xx_small">
                        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right">
                            <lightning-icon
                                size="x-small"
                                class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default"
                                icon-name="utility:search"
                            ></lightning-icon>
                            <input
                                type="text"
                                id="text-input-id"
                                data-function="search"
                                class={inputClasses}
                                onfocus={handleFocus}
                                onblur={handleBlur}
                                value={searchedText}
                                onkeyup={handleChange}
                                onkeydown={handleKeyDown}
                                oninput={handleInput}
                                placeholder={searchPlaceholder}
                                aria-describedby="form-error-01"
                            />
                        </div>
                    </div> 


                        <ul
                            class="slds-listbox slds-listbox_vertical slds-dropdown_length-5 "
                            role="presentation"
                        >
                            <li
                                for:each={tempOptions}
                                for:item="option"
                                key={option.value}
                                role="presentation"
                                class="slds-listbox__item"
                            >
                                <div
                                    onclick={handleSelect}
                                    data-value={option.value}
                                    data-label={option.label}
                                    class={option.classes}
                                    role="option"
                                    data-focused={option.focused}
                                >
                                    <span class="slds-media__figure slds-listbox__option-icon"></span>
                                    <span class="slds-media__body">
                                        <span
                                            class="slds-truncate"
                                            title={option.label}
                                        >{option.label}</span>
                                    </span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div
            class="slds-form-element__help"
            if:true={isInvalid}
            id="form-error-01"
        >{messageWhenInvalid}</div>
    </div>
</template>